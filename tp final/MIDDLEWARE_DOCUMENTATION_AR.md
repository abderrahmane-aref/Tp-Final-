# ๐ก๏ธ ูุธุงู ุงูู Middleware ูู ุงููุดุฑูุน

## ๐ ููุฏูุฉ
ุชู ุฅุถุงูุฉ ูุธุงู Middleware ูุฎุตุต ูููุดุฑูุน ูุชุญุณูู ุฃูุงู ุงููุธุงู ูุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช ุจุดูู ุฃูุถู.

## ๐๏ธ ุงูุจููุฉ ุงูุฌุฏูุฏุฉ

### 1. ููู ุงูู Middleware
**ุงููุณุงุฑ**: `middleware/auth_middleware.py`

ูุญุชูู ุนูู:
- `AuthMiddleware`: ุตูู ูุชูููุฐ ุงูู Middleware
- `ROLE_PERMISSIONS`: ุชุนุฑูู ุงูุตูุงุญูุงุช ุญุณุจ ุงูุฃุฏูุงุฑ
- `check_permission()`: ุฏุงูุฉ ููุชุญูู ูู ุงูุตูุงุญูุงุช
- `get_current_user()`: ุฏุงูุฉ ูุงุณุชุฎุฑุงุฌ ูุนูููุงุช ุงููุณุชุฎุฏู

### 2. ุงูุชูุงูู ูุน ุงูุจุงููุฏ
**ุงูููู**: `main.py`

ุชู ุชุนุฏูู ุงูุชุทุจูู ููุณุชุฎุฏู ุงูู Middleware ุงูุฌุฏูุฏ:
```python
from middleware.auth_middleware import AuthMiddleware

app = FastAPI()
app.add_middleware(AuthMiddleware)
```

## โ๏ธ ููููุฉ ุนูู ุงูู Middleware

### 1. ุงุนุชุฑุงุถ ุงูุทูุจุงุช
- ููุชูุท ูู ุทูุจ HTTP ูุจู ูุนุงูุฌุชู
- ูุชุญูู ูู ูุฌูุฏ ูุนูููุงุช ุงููุณุชุฎุฏู ูู ุงูููุฏุฑุฒ
- ูุฎุฒู ูุนูููุงุช ุงููุณุชุฎุฏู ูู `request.scope` ููุงุณุชุฎุฏุงู ูุงุญูุงู

### 2. ุงูุชุญูู ูู ุงููููุฉ
- ูุจุญุซ ุนู ุงูููุฏุฑุฒ ุงูุชุงููุฉ:
  - `X-User-Role`: ุฏูุฑ ุงููุณุชุฎุฏู
  - `X-User-Name`: ุงุณู ุงููุณุชุฎุฏู
- ุฅุฐุง ูู ุชูุฌุฏ ูุฐู ุงูููุฏุฑุฒุ ูุนูุฏ ุฎุทุฃ 401

### 3. ุชุฎุฒูู ูุนูููุงุช ุงููุณุชุฎุฏู
- ูุฎุฒู ูุนูููุงุช ุงููุณุชุฎุฏู ูู `request.scope["user"]`
- ุชุตุจุญ ูุชููุฑุฉ ูุฌููุน ุงูุฏูุงู ุงููุงุญูุฉ

## ๐ ุงูุชุญุณููุงุช ุงูุฃูููุฉ

### 1. ุญูุงูุฉ ุฃูุถู ููููุงุท ุงูููุงุฆูุฉ
- ุฌููุน ููุงุท API `/api/*` ูุญููุฉ ุชููุงุฆูุงู
- ุงูุตูุญุงุช ุงูุนุงูุฉ ูุซู ุชุณุฌูู ุงูุฏุฎูู ุบูุฑ ูุญููุฉ

### 2. ุชุจุณูุท ุงูุฏูุงู
- ูู ุชุนุฏ ุชุญุชุงุฌ ูุชูุฑูุฑ ุงูููุฏุฑุฒ ููู ุฏุงูุฉ
- ุงุณุชุฎุฑุงุฌ ูุนูููุงุช ุงููุณุชุฎุฏู ุฃุตุจุญ ุขููุงู

### 3. ุชุฑููุฒ ุฃูุถู ููููุฏ
- ูุตู ููุทู ุงููุตุงุฏูุฉ ุนู ููุทู ุงูุฃุนูุงู
- ุณูููุฉ ุงูุตูุงูุฉ ูุงูุชุทููุฑ

## ๐ ุงูููุงุฆุฏ ุงููุญููุฉ

### 1. ุฃูุงู ูุญุณู
- โ ุงูุชุญูู ุงูุขูู ูู ุงููููุฉ ูุจู ูู ุทูุจ
- โ ููุน ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจุดูู ูุฑูุฒู
- โ ุชุณุฌูู ูุญุงููุงุช ุงููุตูู ุบูุฑ ุงููุตุฑุญ

### 2. ุตูุงูุฉ ุฃุณูู
- โ ุชุฑููุฒ ุงูููุฏ ูู ููุงู ูุงุญุฏ
- โ ุฅููุงููุฉ ุชุญุฏูุซ ุงูุตูุงุญูุงุช ุจุณูููุฉ
- โ ุฅููุงููุฉ ุฅุถุงูุฉ ุฃุฏูุงุฑ ุฌุฏูุฏุฉ ุจุณูููุฉ

### 3. ุฃุฏุงุก ุฃูุถู
- โ ูุนุงูุฌุฉ ูุฑูุฒูุฉ ูููุตุงุฏูุฉ
- โ ุชูููู ุงูุชูุฑุงุฑ ูู ุงูููุฏ
- โ ุชุณุฑูุน ุชุทููุฑ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

## ๐ก ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ูุจู ุงูู Middleware:
```python
@app.get("/api/patients")
def get_patients(x_user_role: str = Header(None), x_user_name: str = Header(None)):
    user = get_current_user(x_user_role, x_user_name)
    if not check_permission(user["role"], "patients", "read"):
        raise HTTPException(status_code=403, detail="Access denied")
    # ... ุจุงูู ุงูููุฏ
```

### ุจุนุฏ ุงูู Middleware:
```python
@app.get("/api/patients")
def get_patients(request: Request):
    user = request.scope.get("user", {})
    if not user or not check_permission(user["role"], "patients", "read"):
        raise HTTPException(status_code=403, detail="Access denied")
    # ... ุจุงูู ุงูููุฏ
```

## ๐ ุงูุชุบููุฑุงุช ุงููุทุจูุฉ

### 1. ุงููููุงุช ุงููุนุฏูุฉ:
- `main.py`: ุฅุถุงูุฉ ุงูู Middleware ูุงุณุชุฎุฏุงูู
- `middleware/auth_middleware.py`: ุฅูุดุงุก ููู ุงูู Middleware ุงูุฌุฏูุฏ

### 2. ุงูุฏูุงู ุงููุญุฏุซุฉ:
- ุฌููุน ููุงุท API ุชู ุชุญุฏูุซูุง ูุงุณุชุฎุฏุงู ุงูู Middleware

## ๐ฏ ุงูุฎูุงุตุฉ

ุงูู Middleware ุงูุฌุฏูุฏ ูููุฑ:
- **ุฃูุงู ูุฑูุฒู**: ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช ูู ููุงู ูุงุญุฏ
- **ุณูููุฉ ุงูุงุณุชุฎุฏุงู**: ูุง ุญุงุฌุฉ ูุชูุฑูุฑ ุงูููุฏุฑุฒ ูุฏููุงู
- **ูุงุจููุฉ ุงูุชูุณุน**: ุณูููุฉ ุฅุถุงูุฉ ุฃุฏูุงุฑ ูุตูุงุญูุงุช ุฌุฏูุฏุฉ
- **ุตูุงูุฉ ุฃูุถู**: ุชุฑููุฒ ุงูููุฏ ูุชุญุณูู ูุงุจููุชู ูููุฑุงุกุฉ

## ๐ ุงูุชุญุฏูุซุงุช ุงูุฃุฎูุฑุฉ

### ุชุญุฏูุซ ุตูุงุญูุงุช ุงูุตูุฏูู (Pharmacist)
- โ ุงูุณูุงุญ ููุตูุฏูู ุจุนุฑุถ ุจูุงูุงุช ุงููุฑุถู (ูุฑุงุกุฉ ููุท)
- โ ููุน ุงูุตูุฏูู ูู ุชุนุฏูู ุฃู ุญุฐู ุจูุงูุงุช ุงููุฑุถู
- โ ุงูุญูุงุธ ุนูู ุตูุงุญูุงุช ุงููุฑุงุกุฉ ููุท ูููุตูุงุช ุงูุทุจูุฉ

### ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- โ ุชุญุณูู ุฑุณุงูุฉ ุงูุชุฑุญูุจ ููุฌููุน ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุชุณุฌูู ุงูุฏุฎูู ูุฌููุน ุงููุณุชุฎุฏููู
- โ ุฅุตูุงุญ ุชูุฌูู ุงูุตูุฏูู ุงูุชููุงุฆู ุฅูู ุตูุญุฉ ุงููุฑุถู
- โ ุฅุถุงูุฉ ุตูุญุฉ ุงูููู ุงูุดุฎุตู ููู ูุณุชุฎุฏู
- โ ุฅุถุงูุฉ ุชูููุน ุงููุทูุฑ (Abderrahman Aref) ูู ุฃุณูู ุงูุตูุญุงุช ูุน ุฑุงุจุท ูุตูุญุฉ ุงูููุณุจูู

ุชู ุชุทุจูู ูุฐุง ุงููุธุงู ุจูุฌุงุญ โ